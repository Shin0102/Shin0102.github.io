[{"content":"Â MSA(microservice architectur)ë¥¼ ìœ„í•´ CDK(typescript)ë¥¼ í†µí•´ EKSë¥¼ êµ¬ì„±í•œ ì ì´ ìˆëŠ”ë°, ì´ë•ŒëŠ” ë™ì‘ì—ë§Œ ì§‘ì¤‘í•˜ë‹¤ ë³´ë‹ˆ, ìë™ìœ¼ë¡œ ìƒì„±ë˜ëŠ” ë¦¬ì†ŒìŠ¤ë‚˜ Roleë“¤ì— ëŒ€í•´ í¬ê²Œ ì‹ ê²½ ì“°ì§€ ì•Šì•˜ë‹¤. ê·¸ëŸ¬ë‹¤ ì´ë²ˆì— ë²ˆì¡í•˜ê²Œ ê´€ë¦¬ë˜ëŠ” AWS Resourceë“¤ì— ëŒ€í•´ ì •ë¦¬í•  ê¸°íšŒê°€ ìƒê²¨, ìƒˆë¡œ EKS í™˜ê²½ì„ êµ¬ì„±í•  ê¸°íšŒê°€ ìƒê²¼ë‹¤. ê·¸ì¤‘ì— ì´ë²ˆì—ëŠ” Roleì— ëŒ€í•´ ì •ë¦¬í•´ë³´ë ¤ í•œë‹¤.\nÂ CDKë¥¼ í†µí•´ eksë¥¼ ìƒì„±í•˜ê²Œ ë˜ë©´ roleì— ëŒ€í•´ íŠ¹ë³„íˆ ëª…ì‹œí•˜ì§€ ì•Šì•„ë„, ìë™ìœ¼ë¡œ IAM Roleë“¤ì´ ëª‡ ê°œ ë§Œë“¤ì–´ì§„ë‹¤. Clusterì— ëŒ€í•œ Role, ê·¸ë¦¬ê³  ê°™ì´ ìƒì„±ë˜ëŠ” Lambdaì— ëŒ€í•œ Roleë„ ì—¬ëŸ¬ ê°œ ìˆë‹¤.(Lambda ê´€ë ¨ëœ ê²ƒë“¤ì€ ë‹¤ìŒì— ì •ë¦¬í•´ë´ì•¼ê² ë‹¤) ë¨¼ì € Cluster ê´€ë ¨ Roleì„ ì •ë¦¬í•´ ë³´ë©´ ì•„ë˜ì™€ ê°™ë‹¤.\nKubernetes v1.18, CDK 1.78.0/ ì„¸íŒ…ì— ë”°ë¼ ì´ë¦„ì´ë‚˜, Role ê°œìˆ˜ê°€ ë‹¤ë¥¼ ìˆ˜ ìˆìŒ\n1. {cluster-name}-ClusterCreationRole\n2. {cluster-name}-admin-role\n3. {cluster-name}-eks-role\n4. {cluster-name}-ClusterNodegroupNodesNodeGroupRole 1. {cluster-name}-ClusterCreationRole Â ë¨¼ì € {cluster-name}-ClusterCreationRoleì„ ì‚´í´ë³´ë©´, ClusterCreationRoleDefaultPolicyë¼ëŠ” ì¸ë¼ì¸ Policy(ì´ê²ƒë„ ìë™ìœ¼ë¡œ ìƒì„±ë¨)ê°€ ì—°ê²°ë˜ì–´ìˆë‹¤. ì •ì±… ë‚´ìš©ì—ëŠ” EKS Clusterë¥¼ ìƒì„±ì— ì‚¬ìš©í•  Subnetê³¼ VPCì— ëŒ€í•œ ì •ë³´ì— ëŒ€í•œ ì ‘ê·¼ í—ˆìš©, Cluster ìƒì„±/ì‚­ì œ/ë²„ì „ì—…ë°ì´íŠ¸ ë“± í´ëŸ¬ìŠ¤í„° ìƒì„±ì— ê´€í•œ ê¶Œí•œë“¤ì´ ë‚˜ì—´ë˜ì–´ ìˆë‹¤. ë‚´ìš©ì´ë‚˜ ì´ë¦„ìœ¼ë¡œ ë³´ì•„ cdkì—ì„œ cluster ìƒì„± ë° ê´€ë¦¬í• ë•Œ ì‚¬ìš©í•˜ëŠ” Role ì´ë‹¤.\n2. {cluster-name}-admin-role Â {cluster-name}-admin-roleì€ í™•ì¸í•´ë³´ë©´ ì•„ë¬´ëŸ° Policyë„ ì—°ê²°ë˜ì–´ ìˆì§€ ì•Šë‹¤. ê·¸ë˜ì„œ ì¢€ ì°¾ì•„ë³´ë‹ˆ ë¨¼ì € EKSì¸ì¦ ë°©ì‹ì„ ì•Œì•„ì•¼ í•œë‹¤.\nAWS ì¸ì¦ë°©ì‹: https://docs.aws.amazon.com/ko_kr/eks/latest/userguide/managing-auth.html  \nkubectl ì„ í†µí•´ Clusterì— ì ‘ê·¼í•˜ê²Œ ë˜ë©´ í•´ë‹¹ ìœ ì €ê°€ ì ì ˆí•œ I AM Userì¸ì§€ í™•ì¸í•œ í›„, ì¸ì¦ë˜ë©´ k8s(Kubernetes)ì˜ RBACì„ ì´ìš©í•´ ì ‘ê·¼ì œì–´ë¥¼ í•˜ê²Œ ëœë‹¤. {cluster-name}-admin-roleì€ Clusterë¥¼ ì´ˆê¸° ìƒì„±í•˜ëŠ” Userì—ê²Œ system:mastersë¼ëŠ” ê·¸ë£¹ì„ ë¶€ì—¬í•˜ê²Œ ëœë‹¤. ì´ ê·¸ë£¹ì€ k8s Default ClusterRoleì¸ cluster-admin(super user)ì´ë¼ëŠ” ClusterRoleê³¼ ë°”ì¸ë”©ë˜ì–´ ìˆë‹¤. ê·¸ë˜ì„œ Cluster ì´ˆê¸° ìƒì„±ìëŠ” Clusterê´€í•œ ê±°ì˜ ëª¨ë“  ê¶Œí•œì„ ê°€ì§€ê³  ìˆë‹¤.\nì°¸ê³ . k8s default cluster role and role bidings 3. {cluster-name}-eks-role Â {cluster-name}-eks-roleì€ AmazonEKSClusterPolicyë¼ëŠ” ê¸°ì¡´ Policyê°€ ì—°ê²°ë˜ì–´ ìˆëŠ”ë°, ì„¤ëª…ì„ ë³´ë©´ ì•„ë˜ì™€ ê°™ë‹¤.\nThis policy provides Kubernetes the permissions it requires to manage resources on your behalf. Kubernetes requires Ec2:CreateTags permissions to place identifying information on EC2 resources including but not limited to Instances, Security Groups, and Elastic Network Interfaces.\nk8s ì—ì„œ AWS ë¦¬ì†ŒìŠ¤ë“¤ì„ ê´€ë¦¬í•˜ê¸° ìœ„í•´ í•„ìš”í•œ ê¶Œí•œë“¤ì´ë¼ëŠ” ì„¤ëª…ì´ë‹¤. Policyë¥¼ í™•ì¸í•´ë³´ë©´ EC2, Load Balancer, AutoscalingGroup ë“± ì„œë¹„ìŠ¤ ìš´ì˜ì— ì£¼ìš”í•œ ë¦¬ì†ŒìŠ¤ë“¤ì— ëŒ€í•œ ê¶Œí•œë“¤ì´ í¬í•¨ë˜ì–´ ìˆë‹¤. AWS Consoleì— ë“¤ì–´ê°€ë³´ë©´ ìƒì„±í•œ Clusterì— í•´ë‹¹ Roleì´ ì—°ê²°ë˜ì–´ ìˆëŠ”ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.\n4. {cluster-name}-ClusterNodegroupNodesNodeGroupRole Â ë§ˆì§€ë§‰ìœ¼ë¡œ {{cluster-name}-ClusterNodegroupNodesNodeGroupRoleì„ í™•ì¸í•´ë³´ë©´, ì´ 3ê°€ì§€ì˜ AWS Policyê°€ ì—°ê²°ë˜ì–´ìˆë‹¤.\n AmazonEKSWorkerNodePolicy : EKS Worker nodeë¥¼ EKS Clusterì— ì—°ê²°í•˜ê¸° ìœ„í•œ Policy AmazonEC2ContainerRegistryReadOnly : ECR(ì»¨í…Œì´ë„ˆ ì €ì¥ì†Œ) Readonly Policy AmazonEKS_CNI_Policy : EKSì—ì„œ Conatiner ë“¤ì˜ Network Interfaceë“¤ì„ ê´€ë¦¬í•˜ê¸° ìœ„í•´ EKSëŠ” AWS CNIë¼ëŠ” pluginì„ ì‚¬ìš©í•˜ëŠ”ë°, í•´ë‹¹ í”ŒëŸ¬ê·¸ì¸ì—ê²Œ ì œê³µí•˜ëŠ” Policy  Â í™•ì¸í•´ ë³´ë‹ˆ Container Imageë¥¼ ì½ì–´ì™€ Worker Nodeì•ˆì— Podë“¤ì„ ë°°í¬í• ë•Œ í•„ìš”í•œ ì •ì±…ë“¤ì´ ë“¤ì–´ê°€ ìˆë‹¤. ì‹¤ì œë¡œ Worker Nodeë“¤ì€ EC2 Instanceì— í•´ë‹¹í•˜ê³ , Podë“¤ì€ ì´ Worker Nodeë“¤ ì•ˆì— ì ì ˆíˆ? ë°°í¬ëœë‹¤.\nÂ ì´ì œ Roleë“¤ì— ëŒ€í•´ ì•Œì•„ë´¤ìœ¼ë‹ˆ, ì‹¤ì œ êµ¬ì„±í•œ í™˜ê²½ì—ì„œ í™•ì¸í•´ë³´ì. ì•„ë˜ ëª…ë ¹ì–´ë¡œ eks ìƒì„±ì‹œ ë§Œë“¤ì–´ì§„ aws-auth configmapì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. aws-auth configmapì„ ìˆ˜ì •ì„ í†µí•´ í´ëŸ¬ìŠ¤í„°ì— ì ‘ê·¼í•˜ëŠ” ìœ ì €ë‚˜ Roleì„ ê´€ë¦¬í•  ìˆ˜ ìˆìœ¼ë©°, ì•„ë˜ ëª…ë ¹ì–´ë¥¼ í†µí•´ ìˆ˜ì •í•˜ê±°ë‚˜ yamlì„ í†µí•´ ì ìš©ê°€ëŠ¥í•˜ë‹¤.\n1  kubectl edit -n kube-system configmap/aws-auth   aws auth configmap  \nì²˜ìŒ eksë¥¼ ìƒì„±í•˜ë©´ aws configmapì´ ìœ„ì™€ ê°™ì´ ì •ì˜ë˜ì–´ ìˆë‹¤. (ì‹¤ì œë¡œ String í˜•íƒœë¡œ ë˜ì–´ìˆì—ˆì§€ë§Œ ê°€ë…ì„±ì„ ìœ„í•´ ìœ„ í˜•ì‹ìœ¼ë¡œ ìˆ˜ì •í•˜ì˜€ë‹¤.). ìœ„ì—ì„œ ì„¤ëª…í•œ Workder Nodeê´€ë ¨ Roleê³¼ Cluster ì´ˆê¸° ìƒì„±ìì™€ ê´€ë ¨ëœ Roleì´ ë³´ì¸ë‹¤.\nmapUsersì—ëŠ” ì›ë˜ ì•„ë¬´ê²ƒë„ ì—†ì—ˆì§€ë§Œ, EKS ìƒì„±í›„ì— AWS Console EKSì—ì„œ Nodegroupì— ëŒ€í•œ ì •ë³´ê°€ ì œëŒ€ë¡œ ë‚˜ì˜¤ì§€ì•Šê³  \u0026lsquo;Your current user or role does not have access to Kubernetes objects on this EKS cluster\u0026rsquo; ì—ëŸ¬ê°€ ë‚˜ì™€ì„œ ë¡œê·¸ì¸í•œ I Am userì— master ê¶Œí•œì„ ì¶”ê°€í•´ì£¼ë‹ˆ ì •ìƒì ìœ¼ë¡œ Nodegroup ì •ë³´ê°€ ì¶œë ¥ë˜ì—ˆë‹¤. ë‹¤ë¥¸ìœ ì €ë“¤ì´ EKS Clusterì— ì ‘ê·¼í•˜ê²Œ ì¶”ê°€í•˜ê³ ì‹¶ìœ¼ë©´ mapUsersë¶€ë¶„ì— ì¶”ê°€í•´ì£¼ë©´ ëœë‹¤.\nÂ ì´ê¸€ì€ ì•„ë˜ ë‚´ìš©ì„ ë§ì´ ì°¸ê³ í•˜ì˜€ê³ , EKS í™˜ê²½ì„ êµ¬ì„±í•˜ê²Œ ëœë‹¤ë©´ ê¼­ í•œë²ˆ ë³´ê¸°ë¥¼ ì¶”ì²œí•œë‹¤. Custom Roleê³¼ Groupì„ ë§Œë“œëŠ” ë‚´ìš©ë„ ìˆì–´ ë‹¤ìŒì— í•„ìš”í•˜ë©´ ì„¸íŒ…í•´ë³¼ ì˜ˆì •ì´ë‹¤.\nì¿ ì•Œëª»ì´ Amazon EKSë¡œ ì•ˆì •ì ì¸ ì„œë¹„ìŠ¤ ìš´ì˜í•˜ê¸°\n","description":"","id":0,"section":"posts","tags":["aws eks","cdk","role","iam"],"title":"AWS EKS Roleì— ëŒ€í•œ ê³ ì°°","uri":"https://Shin0102.github.io/posts/devops-aws-eks-role/"},{"content":"hugo zzo í…Œë§ˆì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ shortcodes Â ê¸°ë³¸ì ìœ¼ë¡œ Markdown ë¬¸ë²•ë„ ì œê³µí•˜ì§€ë§Œ, ì•„ë˜ shortcodeë“¤ë„ ì‚¬ìš©ê°€ëŠ¥í•´ì„œ ë¸”ë¡œê·¸ ì“°ëŠ”ë° ìœ ìš©í•  ê²ƒ ê°™ë‹¤. ì´ì™¸ì—ë„ flowchartjsë“± ì°¨íŠ¸ë¼ì´ë¸ŒëŸ¬ë¦¬ë„ ì‚¬ìš©ê°€ëŠ¥í•˜ë‹¤.\nthis is a text this is a text this is a text this is a text   Expand me  Some Markdown Contents   Image4: Image description   success  color Some contents  Some markdown contents Windows MacOS Ubuntu  Windows section 1  console.log(\u0026#39;Hello World!\u0026#39;);     MacOS section Hello world!  Ubuntu section Great!    'use strict'; var containerId = JSON.parse(\"\\\"12abf4928132c6bd\\\"\"); var containerElem = document.getElementById(containerId); var tabLinks = null; var tabContents = null; var ids = []; if (containerElem) { tabLinks = containerElem.querySelectorAll('.tab__link'); tabContents = containerElem.querySelectorAll('.tab__content'); } for (var i = 0; i 0) { tabContents[0].style.display = 'block'; }  emoji-cheat-sheet   I â¤ï¸ ğŸŸ\nzzo theme document\n","description":"","id":1,"section":"posts","tags":["zzo theme"],"title":"zzo theme shortcodes","uri":"https://Shin0102.github.io/posts/etc-zzo-theme-shotcodes/"},{"content":"  ","description":"Alli about page","id":2,"section":"","tags":null,"title":"About","uri":"https://Shin0102.github.io/about/"}]