[{"content":"ê³ ë ¤í•´ì•¼ ë ì   Service Discovery : Containerê°€ Scailing ë˜ì–´ë„ í•´ë‹¹ì„œë¹„ìŠ¤ë¥¼ ì°¾ì„ ìˆ˜ ìˆì–´ì•¼ í•¨ API Gateway : ì™¸ë¶€ì—ì„œ ë‚´ë¶€ì˜ ì„œë¹„ìŠ¤ë“¤ì— ì ‘ê·¼ì— ëŒ€í•œ ì œì–´(ì¸ì¦, ë¡œê¹…, ëª¨ë‹ˆí„°ë§, Response) Load balance : Containerë‚˜ Instance ì„±ëŠ¥ì„ ìœ„í•´ ì™¸ë¶€ìš”ì²­ì„ ì ì ˆíˆ ë¶„ë°° Cirecuit Breaker : í•˜ë‚˜ì˜ ì„œë¹„ìŠ¤ ì¥ì• ê°€ ì „ì²´ ì„œë¹„ìŠ¤ì˜ ì¥ì• ê°€ ë˜ì§€ ì•Šì•„ì•¼í•¨ IPC : ì„œë¹„ìŠ¤ ì‚¬ì´ì˜ í†µì‹   Sync : HTTP, gRPC Async : RabbitMQ, AWS SQS, Kafka, Kinesis ë“±ë“±   DDD (Domain Drive Design -\u0026gt; Event storming, Bounded context) : MSAë¥¼ ì–´ë–»ê²Œ êµ¬ì„±í• ì§€ì— ëŒ€í•œ ë°©ë²•ë¡   MSA Pattern  SAGA : MSAì—ì„œì˜ íŠ¸ëœì­ì…˜ ì²˜ë¦¬  Choreography-Based Saga Orchestrations-Based Saga   Event Source : ë°œìƒí•˜ëŠ” ëª¨ë“  eventë¥¼ event tableì˜ ì €ì¥ CQRS : CUDì™€ Readë¥¼ ë¶„ë¦¬(AWS DynamoDBì™€ ê°™ì€ DBì™€ sync), Event Source íŒ¨í„´ê³¼ ê²°í•©  ","description":"","id":0,"section":"posts","tags":["MSA"],"title":"MSA ì„¤ê³„ì‹œ ê³ ë ¤í•´ì•¼ë  ì ê³¼ Pattern","uri":"https://Shin0102.github.io/posts/devops-msa-considerations/"},{"content":"ë“¤ì–´ê°€ë©° Â ì‘ë…„ë¶€í„° íšŒì‚¬ì˜ ê±°ëŒ€í•œ ë ˆê±°ì‹œ ì‹œìŠ¤í…œì„ Python ê¸°ë°˜ì˜ API ì„œë²„ë¡œ ì¡°ê¸ˆì”© í¬íŒ…í•˜ê³  ìˆë‹¤. í•œë²ˆì— ëª¨ë‘ í¬íŒ…í•˜ê¸°ë€ ë¶ˆê°€ëŠ¥í•˜ê¸°ì— MSAë¥¼ ê¸°ë°˜ìœ¼ë¡œ ì—¬ëŸ¬ ê¸°ëŠ¥ë“¤ë¡œ ë‚˜ëˆ„ì–´(ë©”ì‹œì§€, ê²°ì œ, ê³ ê°ìš© API ë“±ë“±\u0026hellip;) í¬íŒ…ì„ ì§„í–‰í•˜ì˜€ë‹¤. í•˜ì§€ë§Œ ì²˜ìŒì— ë°°í¬í™˜ê²½ì´ë‚˜ Framework ëŒ€í•œ ê²°ì •ì—†ì´ ê°ê° ì§„í–‰í•˜ë‹¤ë³´ë‹ˆ, AWS EC2, Lambda, ECSë“± ë‹¤ì–‘í•œ í™˜ê²½ì—ì„œ API ì„œë²„ë“¤ì´ ëŒì•„ê°”ë‹¤. ê·¸ëŸ¬ë‹¤ ë³´ë‹ˆ í•´ë‹¹ ëª¨ë“ˆì˜ ë‹´ë‹¹ìê°€ ì—†ìœ¼ë©´ ì„œë¹„ìŠ¤ë¥¼ ë°°í¬í•˜ê¸°ê°€ í˜ë“  í™˜ê²½ì´ ë˜ì—ˆê³ , ë°°í¬ë¥¼ ìœ„í•´ì„œ ë…¸íŠ¸ë¶ë§ˆë‹¤ í™˜ê²½ì— ë§ëŠ” ì„¸íŒ…ì´ í•„ìš”í•˜ê²Œ ë˜ì—ˆë‹¤. ì´ëŸ¬í•œ ìƒí™©ì„ ê·¹ë³µí•˜ê¸° ìœ„í•´ ë°°í¬í™˜ê²½ì„ í†µì¼í•˜ëŠ”ê²Œ í•„ìš”í•˜ì˜€ê³ , ê·¸ë˜ì„œ ì•„ë˜ì™€ ê°™ì´ EKS ê¸°ë°˜ì˜ ë°°í¬ ìë™í™” íŒŒì´í”„ë¼ì¸ì„ êµ¬ì¶•í•˜ì˜€ë‹¤.\nKubernetes ë°°í¬ ìë™í™” ë°°í¬ ìë™í™”ë¥¼ ìœ„í•œ EKS pipeline:  \nì°¸ê³ . MSAë¥¼ ìœ„í•œ Kubernetes ì„¸íŒ…ê³¼ CI/CD Pipeline êµ¬ì„±\nêµ¬ì„±í•˜ëŠ”ë° ìœ„ ë¸”ë¡œê·¸ì˜ ë„ì›€ì„ ë§ì´ ë°›ì•˜ìœ¼ë©°, í¬ê²Œ ë‹¤ë¥¸ì ì€ Jenkins ëŒ€ì‹ ì— CDKë¡œ AWS CodePipelineì„ ìƒì„±í•˜ì—¬ ì‚¬ìš©í•˜ì˜€ë‹¤. ê°„ë‹¨íˆ Flowë¥¼ ì„¤ëª…í•˜ë©´ ì•„ë˜ì™€ ê°™ë‹¤.\nflow 1. Code commit\n2. AWS CodePipelineì—ì„œ Code commit ì´ë²¤íŠ¸ë¥¼ ë°›ì•„ Docker Build í•˜ê³  ECRì— í•´ë‹¹ ì´ë¯¸ì§€ë¥¼ Push\n3. AWS CodePipelineì—ì„œ GitOps repositoryì— ìˆëŠ” helm values fileì„ ì—…ë°ì´íŠ¸ (ì´ë¯¸ì§€ íƒœê·¸ë‚˜ secret value ë“±ë“±)\n4. AWS CodePipeline \u0026lsquo;success\u0026rsquo; ë˜ëŠ” \u0026lsquo;fail\u0026rsquo;ì„ ìŠ¬ë™ìœ¼ë¡œ ì•Œë¦¼\n5. argocd ì—ì„œ Girpops repositoryì˜ ë³€ê²½ë‚´ì—­ì´ ë°œìƒí•˜ë©´, ë³€ê²½ëœ ë‚´ìš©ì„ ê¸°ë°˜ìœ¼ë¡œ ìë™(or ìˆ˜ë™)ìœ¼ë¡œ Kubernetesë‚´ì˜ Resourceë¥¼ ì—…ë°ì´íŠ¸ í•œë‹¤.\nì‹¤ì œ ìš´ì˜ì¤‘ì¸ gui:  \nì‹¤ì œë¡œ ìœ„ì™€ ê°™ì´ ë°°í¬ íŒŒì´í”„ë¼ì¸ì„ êµ¬ì¶•í•˜ê³  ë‚œ ë’¤ì—ëŠ” ë°°í¬ì— ëŒ€í•œ ë¶€ë‹´ì´ ë§ì´ ì¤„ì–´ë“¤ì—ˆë‹¤. ë°°í¬ë¥¼ ìœ„í•œ ë‹¤ë¥¸ ì„¸íŒ…ì´ë‚˜ Kubernetes Cluster ì ‘ê·¼í•  í•„ìš”ì—†ì´ argocd guië¥¼ í†µí•´ ë°°í¬ \u0026amp; ë¡¤ë°±ì„ ë§¤ìš° í¸í•˜ê²Œ í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆê¸° ë•Œë¬¸ì´ë‹¤. í•˜ì§€ë§Œ í”„ë¡œì íŠ¸ë¥¼ ìƒˆë¡œ ìƒì„± í• ë•Œë§ˆë‹¤, AWS CodePipelineì„ ì¶”ê°€ë¥¼ í•´ì¤˜ì•¼í•˜ëŠ” ìˆ˜ê³ ìŠ¤ëŸ¬ì›€?ì´ ë°œìƒí•œë‹¤. ë¬¼ë¡  CDKë¥¼ ì´ìš©í•˜ì—¬ ì´ê²ƒë„ ìë™í™”ë¥¼ í•˜ì˜€ì§€ë§Œ, ë§¤ë²ˆ AWS CodePipelineì„ ìƒì„±í•´ì•¼ ëœë‹¤ëŠ” ê²ƒì´ ê·¸ë ‡ê²Œ ë°˜ê°€ìš´ ìƒí™©ì€ ì•„ë‹ˆì—ˆë‹¤. ê·¸ë ‡ê²Œ ê³ ë¯¼í•˜ë˜ì¤‘ github actionì„ ì•Œê²Œ ë˜ì—ˆê³ , íŒŒì´í”„ë¼ì¸ êµ¬ì¶•ì„ ì¢€ ë” ê°„ì†Œí™” í•  ìˆ˜ ìˆì„ê²ƒ ê°™ì€ ê¸°ëŒ€ê°ì„ ê°€ì§€ê³  ì„¸íŒ…ì„ ì‹œì‘í•´ë³´ì•˜ë‹¤.(github actionì„ ì¨ë³´ê³  ì‹¶ê¸°ë„ í•˜ì˜€ë‹¤..)\ngithub action Â github actionì´ë€ githubì—ì„œ ì œê³µí•˜ëŠ” CI/CD íˆ´ì´ë‹¤. ì‚¬ìš©ë²•ì€ ê°„ë‹¨í•˜ë‹¤. gitub projectì— Actions íƒ­ì— ë“¤ì–´ê°€ë©´ ìƒˆë¡œìš´ workflowë¥¼ ë§Œë“¤ ìˆ˜ ìˆë‹¤. yml íŒŒì¼ë¡œ ë§Œë“¤ì–´ì§€ë©°, ìƒì„±ëœ íŒŒì¼ì€ defaultë¡œ .github/workflows/{name}.yml ìœ„ì¹˜í•˜ê²Œ ëœë‹¤. ìì„¸í•œ ì„¤ëª…ì€ ì˜ ì •ë¦¬í•´ì£¼ì‹  ë¸”ë¡œê±°ê°€ ë§ìœ¼ë‹ˆ ì°¸ê³ í•˜ë©´ ë  ê²ƒ ê°™ë‹¤. ì¼ë‹¨ í•´ì•¼ë  workì„ ì •í•´ë³´ë©´ ì•„ë˜ì™€ ê°™ë‹¤.\n docker build AWS ECR push GitOps repositoryì˜ Kubernetes deployment.yaml image tagë¥¼ update  \nGitOps repostroyì˜ Kubernetes deploymnet.yamlì˜ image tagì— ë¹Œë“œëœ ì´ë¯¸ì§€ì˜ íƒœê·¸ê°€ ì—…ë°ì´íŠ¸ ë˜ë©´, GitOps repositoryì™€ ì—°ë™í•´ë†“ì€ argocd ì—ì„œ ìë™(or ìˆ˜ë™)ìœ¼ë¡œ Clusterì— í•´ë‹¹í•˜ëŠ” Podë¥¼ ì—…ë°ì´íŠ¸ í•˜ì—¬ syncë¥¼ ë§ì¶˜ë‹¤. ì¼ë‹¨ ìœ„ ì‘ì—…ë“¤ì„ ì •ì˜í•œ github actionì€ ì•„ë˜ì™€ ê°™ë‹¤.\n project name : í…ŒìŠ¤íŠ¸ë¼ ê°€ì •. gitops repo ì•„ë˜ ê²½ë¡œì— k8s yaml(service, deployment)ì´ ì •ì˜ë˜ì–´ìˆë‹¤ê³  ê°€ì •.  gitops repo/dev/í…ŒìŠ¤íŠ¸/resources.yaml gitops repo/prod/í…ŒìŠ¤íŠ¸/resources.yaml   (github actionì„ ìˆ˜í–‰í•˜ê¸°ì „ì— ì•„ë˜ ê°’ë“¤ì„ github secretsì— ì„¸íŒ…í•„ìš”)\n  Github Secrets   AWS_ACCESS_KEY_ID_VAL AWS_SECRET_ACCESS_KEY_VAL ECR_REPOSITORY -\u0026gt; AWS ECR Repository ì´ë¦„ GIT_ACCESS_TOKEN -\u0026gt; gitops git repsitoryë¥¼ checkout í•˜ê¸°ìœ„í•œ Token     ì˜ˆì œ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93  on:push:branches:- master- featurename:Docker Image build \u0026amp; k8s resources.yaml updatejobs:deploy:name:Deployruns-on:ubuntu-lateststeps:- name:Checkoutuses:actions/checkout@v2- name:Set Dev env variablesif:endsWith(github.ref, \u0026#39;/feature\u0026#39;)run:|echo \u0026#34;Feature branch\u0026#34; echo \u0026#34;ENVIRONMENT=dev\u0026#34; \u0026gt;\u0026gt; $GITHUB_ENV echo \u0026#34;DESTINATION=dev/í…ŒìŠ¤íŠ¸\u0026#34; \u0026gt;\u0026gt; $GITHUB_ENV echo \u0026#34;BRANCH=feature\u0026#34; \u0026gt;\u0026gt; $GITHUB_ENV- name:Set Prod env variablesif:endsWith(github.ref, \u0026#39;/master\u0026#39;)run:|echo \u0026#34;Master branch\u0026#34; echo \u0026#34;ENVIRONMENT=prod\u0026#34; \u0026gt;\u0026gt; $GITHUB_ENV echo \u0026#34;DESTINATION=prod/í…ŒìŠ¤íŠ¸\u0026#34; \u0026gt;\u0026gt; $GITHUB_ENV echo \u0026#34;BRANCH=master\u0026#34; \u0026gt;\u0026gt; $GITHUB_ENV- name:Set commit msg env:GITHUB_SHA:${{ github.sha }}run:|echo \u0026#34;COMMIT_MSG=Update from https://github.com/your/í…ŒìŠ¤íŠ¸/$GITHUB_SHA\u0026#34; \u0026gt;\u0026gt; $GITHUB_ENV echo $COMMIT_MSG## Push app image to ECR#- name:Configure AWS credentialsuses:aws-actions/configure-aws-credentials@v1with:aws-access-key-id:${{ secrets.AWS_ACCESS_KEY_ID_VAL }}aws-secret-access-key:${{ secrets.AWS_SECRET_ACCESS_KEY_VAL }}aws-region:ap-northeast-2- name:Login to Amazon ECRid:login-ecruses:aws-actions/amazon-ecr-login@v1- name:Build, tag, and push image to Amazon ECRid:build-imageenv:ECR_REGISTRY:${{ steps.login-ecr.outputs.registry }}ECR_REPOSITORY:${{ secrets.ECR_REPOSITORY }}IMAGE_TAG:${{ github.sha }}run:|docker build -t $ECR_REGISTRY/$ECR_REPOSITORY:$ENVIRONMENT-$IMAGE_TAG {Dockerfile ê²½ë¡œ} docker push $ECR_REGISTRY/$ECR_REPOSITORY:$ENVIRONMENT-$IMAGE_TAG echo \u0026#34;::set-output name=image::$ECR_REGISTRY/$ECR_REPOSITORY:$ENVIRONMENT-$IMAGE_TAG\u0026#34; ## Update Image tag to delployment.yaml#- name:Git configrun:|git config --global user.email \u0026#34;actions@github.com\u0026#34; git config --global user.name \u0026#34;GitHub Actions\u0026#34; - name:Check out k8s repouses:actions/checkout@masterwith:repository:your/gitops-repositorytoken:${{ secrets.GIT_ACCESS_TOKEN }}- name:chmod repo destinationrun:|chmod +x $DESTINATION ls - name:git push image tag to k8 repo env:GITHUB_REPO:${{ github.repository.name }}GITHUB_SHA:${{ github.sha }}run:|sed -i -e \u0026#39;s@${{ steps.login-ecr.outputs.registry }}/${{ secrets.ECR_REPOSITORY }}:.*@${{ steps.build-image.outputs.image }}@g\u0026#39; $DESTINATION/resources.yaml git add . git commit -m \u0026#34;$COMMIT_MSG\u0026#34; git push -f --set-upstream origin main  Â êµ¬ì¡°ë¥¼ ë³´ë©´ íŠ¸ë¦¬ê±° / build í™˜ê²½ / ì‹¤ì œ ìˆ˜í–‰í•  stepë“¤ì´ ì •ì˜ë˜ì–´ ìˆë‹¤. feature, master branch ì— pushë ë•Œ devì™€ production ì„œë²„ë¥¼ ì—…ë°ì´íŠ¸ í•˜ê¸°ìœ„í•œ github actionì´ë‹¤. ë¼ì¸ë³„ ì„¤ëª…ì€ ì•„ë˜ì™€ ê°™ë‹¤.\nline 19~33 : GitOps repositoryì— í•´ë‹¹ í”„ë¡œì íŠ¸ì˜ kubernetes ë¦¬ì†ŒìŠ¤ë“¤ì´ ìˆëŠ” pathë¥¼ ì§€ì •í•´ì¤€ë‹¤.(dev, prod)\nline 39 : GitOpsì— commití•  msg ì§€ì • -\u0026gt; í˜„ì¬ commitì˜ url linkë¥¼ commit msgë¡œ í•˜ê¸°ìœ„í•´ repository urlì„ ì„¸íŒ…í•´ì¤€ë‹¤.\nline 55~64 : docker buildí•˜ê³  ì§€ì •í•œ ECRì— push\nline 74~78 : GitOps repository checkout\nline 80~83 : ì‹¤í–‰ê¶Œí•œ ì¶”ê°€\nline 85~93 : k8s deploymentê°€ ì •ì˜ëœ yaml íŒŒì¼ì˜ tagë¥¼ ì—…ë°ì´íŠ¸\nAWS CodePipelineê³¼ ë¹„êµ Â ì¼ë‹¨ ê¸°ì¡´ì˜ ì‚¬ìš©í•˜ë˜ codepipe lineê³¼ ë¹„êµí•´ë³´ë©´ ì‚¬ìš©ë²•ì´ êµ‰ì¥íˆ ì‰¬ì› ë‹¤. AWS Codepipelineë„ iac tool ì„ ì´ìš©í•´ì„œ ì‰½ê²Œ ì„¸íŒ…í•  ìˆ˜ ìˆì§€ë§Œ, ì´ˆê¸° ì„¸íŒ…ì´ ì‰½ì§€ëŠ” ì•Šì•˜ë‹¤. ê·¸ë¦¬ê³  github actionì´ ì¢‹ì•˜ë˜ ê²ƒì´ ë¸Œëœì¹˜ë³„ë¡œ pipelineì„ êµ¬ì„±í•  í•„ìš”ê°€ ì—†ë‹¤ëŠ” ê²ƒì´ êµ‰ì¥íˆ í¸ë¦¬í–ˆë‹¤. stepì—ì„œ ì¡°ê±´ë¬¸ì„ ì´ìš©í•˜ë©´ branch ë³„ë¡œ actionì„ ì œì–´í•  ìˆ˜ ìˆë‹¤. ë§ˆì§€ë§‰ìœ¼ë¡œ ë¹Œë“œ ì‹œê°„ì—ì„œ ìƒê°ë³´ë‹¤ ë§ì€ ì°¨ì´ê°€ ë‚¬ë‹¤. ê¸°ì¡´ CodePipelineì„ ì‚¬ìš©í–ˆì„ë•ŒëŠ” 5~6ë¶„ì •ë„ ì†Œìš” ë˜ì—ˆëŠ”ë° github actionì€ ì ˆë°˜ë„ ì•ˆë˜ëŠ” ì‹œê°„ì´(2ë¶„ ì •ë„) ì†Œìš”ë˜ì—ˆë‹¤.\nì°¸ê³ . GitHub Actions vs. AWS CodePipeline\në§ˆì¹˜ë©° Â AWS CodePipelineì—ì„œ github actionìœ¼ë¡œ cd pipelineì„ ë³€ê²½í•˜ë©´ì„œ êµ¬ì„±ì´ êµ‰ì¥íˆ ê°€ë²¼ì›Œì§„ ëŠë‚Œì´ ë“¤ì—ˆë‹¤. í”„ë¡œì íŠ¸ ë‚´ì—ì„œ branchë³„ë¡œ pipelineì„ ë§Œë“¤ í•„ìš”ë„ ì—†ê³ , ê°„ë‹¨íˆ í”„ë¡œì íŠ¸ repositoryì— workflowê°€ ì •ì˜ëœ ymlíŒŒì¼ë§Œ ì¶”ê°€í•´ì£¼ë©´ ë˜ê¸° ë•Œë¬¸ì´ë‹¤. ê²°ê³¼ì ìœ¼ë¡œëŠ” githubì„ repositoryë¡œ ì‚¬ìš©í•˜ê³  ìˆê³ , AWS Resourceì— ì˜ì¡´ì„±ì´ í¬ì§€ ì•Šìœ¼ë©´ github actionì„ ì‚¬ìš©í•˜ì§€ ì•Šì„ ì´ìœ ëŠ” ì—†ì„ ê²ƒ ê°™ë‹¤.\n","description":"","id":1,"section":"posts","tags":["github action","Kubernetes","argocd"],"title":"github actionìœ¼ë¡œ Kubernetes ë°°í¬ ìë™í™”","uri":"https://Shin0102.github.io/posts/devops-github-action/"},{"content":"Â MSA(microservice architectur)ë¥¼ ìœ„í•´ CDK(typescript)ë¥¼ í†µí•´ EKSë¥¼ êµ¬ì„±í•œ ì ì´ ìˆëŠ”ë°, ì´ë•ŒëŠ” ë™ì‘ì—ë§Œ ì§‘ì¤‘í•˜ë‹¤ ë³´ë‹ˆ, ìë™ìœ¼ë¡œ ìƒì„±ë˜ëŠ” ë¦¬ì†ŒìŠ¤ë‚˜ Roleë“¤ì— ëŒ€í•´ í¬ê²Œ ì‹ ê²½ ì“°ì§€ ì•Šì•˜ë‹¤. ê·¸ëŸ¬ë‹¤ ì´ë²ˆì— ë²ˆì¡í•˜ê²Œ ê´€ë¦¬ë˜ëŠ” AWS Resourceë“¤ì— ëŒ€í•´ ì •ë¦¬í•  ê¸°íšŒê°€ ìƒê²¨, ìƒˆë¡œ EKS í™˜ê²½ì„ êµ¬ì„±í•  ê¸°íšŒê°€ ìƒê²¼ë‹¤. ê·¸ì¤‘ì— ì´ë²ˆì—ëŠ” Roleì— ëŒ€í•´ ì •ë¦¬í•´ë³´ë ¤ í•œë‹¤.\nÂ CDKë¥¼ í†µí•´ eksë¥¼ ìƒì„±í•˜ê²Œ ë˜ë©´ roleì— ëŒ€í•´ íŠ¹ë³„íˆ ëª…ì‹œí•˜ì§€ ì•Šì•„ë„, ìë™ìœ¼ë¡œ IAM Roleë“¤ì´ ëª‡ ê°œ ë§Œë“¤ì–´ì§„ë‹¤. Clusterì— ëŒ€í•œ Role, ê·¸ë¦¬ê³  ê°™ì´ ìƒì„±ë˜ëŠ” Lambdaì— ëŒ€í•œ Roleë„ ì—¬ëŸ¬ ê°œ ìˆë‹¤.(Lambda ê´€ë ¨ëœ ê²ƒë“¤ì€ ë‹¤ìŒì— ì •ë¦¬í•´ë´ì•¼ê² ë‹¤) ë¨¼ì € Cluster ê´€ë ¨ Roleì„ ì •ë¦¬í•´ ë³´ë©´ ì•„ë˜ì™€ ê°™ë‹¤.\nKubernetes v1.18, CDK 1.78.0/ ì„¸íŒ…ì— ë”°ë¼ ì´ë¦„ì´ë‚˜, Role ê°œìˆ˜ê°€ ë‹¤ë¥¼ ìˆ˜ ìˆìŒ\n1. {cluster-name}-ClusterCreationRole\n2. {cluster-name}-admin-role\n3. {cluster-name}-eks-role\n4. {cluster-name}-ClusterNodegroupNodesNodeGroupRole 1. {cluster-name}-ClusterCreationRole Â ë¨¼ì € {cluster-name}-ClusterCreationRoleì„ ì‚´í´ë³´ë©´, ClusterCreationRoleDefaultPolicyë¼ëŠ” ì¸ë¼ì¸ Policy(ì´ê²ƒë„ ìë™ìœ¼ë¡œ ìƒì„±ë¨)ê°€ ì—°ê²°ë˜ì–´ìˆë‹¤. ì •ì±… ë‚´ìš©ì—ëŠ” EKS Clusterë¥¼ ìƒì„±ì— ì‚¬ìš©í•  Subnetê³¼ VPCì— ëŒ€í•œ ì •ë³´ì— ëŒ€í•œ ì ‘ê·¼ í—ˆìš©, Cluster ìƒì„±/ì‚­ì œ/ë²„ì „ì—…ë°ì´íŠ¸ ë“± í´ëŸ¬ìŠ¤í„° ìƒì„±ì— ê´€í•œ ê¶Œí•œë“¤ì´ ë‚˜ì—´ë˜ì–´ ìˆë‹¤. ë‚´ìš©ì´ë‚˜ ì´ë¦„ìœ¼ë¡œ ë³´ì•„ cdkì—ì„œ cluster ìƒì„± ë° ê´€ë¦¬í• ë•Œ ì‚¬ìš©í•˜ëŠ” Role ì´ë‹¤.\n2. {cluster-name}-admin-role Â {cluster-name}-admin-roleì€ í™•ì¸í•´ë³´ë©´ ì•„ë¬´ëŸ° Policyë„ ì—°ê²°ë˜ì–´ ìˆì§€ ì•Šë‹¤. ê·¸ë˜ì„œ ì¢€ ì°¾ì•„ë³´ë‹ˆ ë¨¼ì € EKSì¸ì¦ ë°©ì‹ì„ ì•Œì•„ì•¼ í•œë‹¤.\nAWS ì¸ì¦ë°©ì‹: https://docs.aws.amazon.com/ko_kr/eks/latest/userguide/managing-auth.html  \nkubectl ì„ í†µí•´ Clusterì— ì ‘ê·¼í•˜ê²Œ ë˜ë©´ í•´ë‹¹ ìœ ì €ê°€ ì ì ˆí•œ I AM Userì¸ì§€ í™•ì¸í•œ í›„, ì¸ì¦ë˜ë©´ k8s(Kubernetes)ì˜ RBACì„ ì´ìš©í•´ ì ‘ê·¼ì œì–´ë¥¼ í•˜ê²Œ ëœë‹¤. {cluster-name}-admin-roleì€ Clusterë¥¼ ì´ˆê¸° ìƒì„±í•˜ëŠ” Userì—ê²Œ system:mastersë¼ëŠ” ê·¸ë£¹ì„ ë¶€ì—¬í•˜ê²Œ ëœë‹¤. ì´ ê·¸ë£¹ì€ k8s Default ClusterRoleì¸ cluster-admin(super user)ì´ë¼ëŠ” ClusterRoleê³¼ ë°”ì¸ë”©ë˜ì–´ ìˆë‹¤. ê·¸ë˜ì„œ Cluster ì´ˆê¸° ìƒì„±ìëŠ” Clusterê´€í•œ ê±°ì˜ ëª¨ë“  ê¶Œí•œì„ ê°€ì§€ê³  ìˆë‹¤.\nì°¸ê³ . k8s default cluster role and role bidings 3. {cluster-name}-eks-role Â {cluster-name}-eks-roleì€ AmazonEKSClusterPolicyë¼ëŠ” ê¸°ì¡´ Policyê°€ ì—°ê²°ë˜ì–´ ìˆëŠ”ë°, ì„¤ëª…ì„ ë³´ë©´ ì•„ë˜ì™€ ê°™ë‹¤.\nThis policy provides Kubernetes the permissions it requires to manage resources on your behalf. Kubernetes requires Ec2:CreateTags permissions to place identifying information on EC2 resources including but not limited to Instances, Security Groups, and Elastic Network Interfaces.\nk8s ì—ì„œ AWS ë¦¬ì†ŒìŠ¤ë“¤ì„ ê´€ë¦¬í•˜ê¸° ìœ„í•´ í•„ìš”í•œ ê¶Œí•œë“¤ì´ë¼ëŠ” ì„¤ëª…ì´ë‹¤. Policyë¥¼ í™•ì¸í•´ë³´ë©´ EC2, Load Balancer, AutoscalingGroup ë“± ì„œë¹„ìŠ¤ ìš´ì˜ì— ì£¼ìš”í•œ ë¦¬ì†ŒìŠ¤ë“¤ì— ëŒ€í•œ ê¶Œí•œë“¤ì´ í¬í•¨ë˜ì–´ ìˆë‹¤. AWS Consoleì— ë“¤ì–´ê°€ë³´ë©´ ìƒì„±í•œ Clusterì— í•´ë‹¹ Roleì´ ì—°ê²°ë˜ì–´ ìˆëŠ”ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.\n4. {cluster-name}-ClusterNodegroupNodesNodeGroupRole Â ë§ˆì§€ë§‰ìœ¼ë¡œ {{cluster-name}-ClusterNodegroupNodesNodeGroupRoleì„ í™•ì¸í•´ë³´ë©´, ì´ 3ê°€ì§€ì˜ AWS Policyê°€ ì—°ê²°ë˜ì–´ìˆë‹¤.\n AmazonEKSWorkerNodePolicy : EKS Worker nodeë¥¼ EKS Clusterì— ì—°ê²°í•˜ê¸° ìœ„í•œ Policy AmazonEC2ContainerRegistryReadOnly : ECR(ì»¨í…Œì´ë„ˆ ì €ì¥ì†Œ) Readonly Policy AmazonEKS_CNI_Policy : EKSì—ì„œ Conatiner ë“¤ì˜ Network Interfaceë“¤ì„ ê´€ë¦¬í•˜ê¸° ìœ„í•´ EKSëŠ” AWS CNIë¼ëŠ” pluginì„ ì‚¬ìš©í•˜ëŠ”ë°, í•´ë‹¹ í”ŒëŸ¬ê·¸ì¸ì—ê²Œ ì œê³µí•˜ëŠ” Policy  Â í™•ì¸í•´ ë³´ë‹ˆ Container Imageë¥¼ ì½ì–´ì™€ Worker Nodeì•ˆì— Podë“¤ì„ ë°°í¬í• ë•Œ í•„ìš”í•œ ì •ì±…ë“¤ì´ ë“¤ì–´ê°€ ìˆë‹¤. ì‹¤ì œë¡œ Worker Nodeë“¤ì€ EC2 Instanceì— í•´ë‹¹í•˜ê³ , Podë“¤ì€ ì´ Worker Nodeë“¤ ì•ˆì— ì ì ˆíˆ? ë°°í¬ëœë‹¤.\nÂ ì´ì œ Roleë“¤ì— ëŒ€í•´ ì•Œì•„ë´¤ìœ¼ë‹ˆ, ì‹¤ì œ êµ¬ì„±í•œ í™˜ê²½ì—ì„œ í™•ì¸í•´ë³´ì. ì•„ë˜ ëª…ë ¹ì–´ë¡œ eks ìƒì„±ì‹œ ë§Œë“¤ì–´ì§„ aws-auth configmapì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤. aws-auth configmapì„ ìˆ˜ì •ì„ í†µí•´ í´ëŸ¬ìŠ¤í„°ì— ì ‘ê·¼í•˜ëŠ” ìœ ì €ë‚˜ Roleì„ ê´€ë¦¬í•  ìˆ˜ ìˆìœ¼ë©°, ì•„ë˜ ëª…ë ¹ì–´ë¥¼ í†µí•´ ìˆ˜ì •í•˜ê±°ë‚˜ yamlì„ í†µí•´ ì ìš©ê°€ëŠ¥í•˜ë‹¤.\n1  kubectl edit -n kube-system configmap/aws-auth   aws auth configmap  \nì²˜ìŒ eksë¥¼ ìƒì„±í•˜ë©´ aws configmapì´ ìœ„ì™€ ê°™ì´ ì •ì˜ë˜ì–´ ìˆë‹¤. (ì‹¤ì œë¡œ String í˜•íƒœë¡œ ë˜ì–´ìˆì—ˆì§€ë§Œ ê°€ë…ì„±ì„ ìœ„í•´ ìœ„ í˜•ì‹ìœ¼ë¡œ ìˆ˜ì •í•˜ì˜€ë‹¤.). ìœ„ì—ì„œ ì„¤ëª…í•œ Workder Nodeê´€ë ¨ Roleê³¼ Cluster ì´ˆê¸° ìƒì„±ìì™€ ê´€ë ¨ëœ Roleì´ ë³´ì¸ë‹¤.\nmapUsersì—ëŠ” ì›ë˜ ì•„ë¬´ê²ƒë„ ì—†ì—ˆì§€ë§Œ, EKS ìƒì„±í›„ì— AWS Console EKSì—ì„œ Nodegroupì— ëŒ€í•œ ì •ë³´ê°€ ì œëŒ€ë¡œ ë‚˜ì˜¤ì§€ì•Šê³  \u0026lsquo;Your current user or role does not have access to Kubernetes objects on this EKS cluster\u0026rsquo; ì—ëŸ¬ê°€ ë‚˜ì™€ì„œ ë¡œê·¸ì¸í•œ I Am userì— master ê¶Œí•œì„ ì¶”ê°€í•´ì£¼ë‹ˆ ì •ìƒì ìœ¼ë¡œ Nodegroup ì •ë³´ê°€ ì¶œë ¥ë˜ì—ˆë‹¤. ë‹¤ë¥¸ìœ ì €ë“¤ì´ EKS Clusterì— ì ‘ê·¼í•˜ê²Œ ì¶”ê°€í•˜ê³ ì‹¶ìœ¼ë©´ mapUsersë¶€ë¶„ì— ì¶”ê°€í•´ì£¼ë©´ ëœë‹¤.\nÂ ì´ê¸€ì€ ì•„ë˜ ë‚´ìš©ì„ ë§ì´ ì°¸ê³ í•˜ì˜€ê³ , EKS í™˜ê²½ì„ êµ¬ì„±í•˜ê²Œ ëœë‹¤ë©´ ê¼­ í•œë²ˆ ë³´ê¸°ë¥¼ ì¶”ì²œí•œë‹¤. Custom Roleê³¼ Groupì„ ë§Œë“œëŠ” ë‚´ìš©ë„ ìˆì–´ ë‹¤ìŒì— í•„ìš”í•˜ë©´ ì„¸íŒ…í•´ë³¼ ì˜ˆì •ì´ë‹¤.\nì¿ ì•Œëª»ì´ Amazon EKSë¡œ ì•ˆì •ì ì¸ ì„œë¹„ìŠ¤ ìš´ì˜í•˜ê¸°\n","description":"","id":2,"section":"posts","tags":["aws eks","cdk","role","iam"],"title":"AWS EKS Roleì— ëŒ€í•œ ê³ ì°°","uri":"https://Shin0102.github.io/posts/devops-aws-eks-role/"},{"content":"hugo zzo í…Œë§ˆì—ì„œ ì‚¬ìš© ê°€ëŠ¥í•œ shortcodes Â ê¸°ë³¸ì ìœ¼ë¡œ Markdown ë¬¸ë²•ë„ ì œê³µí•˜ì§€ë§Œ, ì•„ë˜ shortcodeë“¤ë„ ì‚¬ìš©ê°€ëŠ¥í•´ì„œ ë¸”ë¡œê·¸ ì“°ëŠ”ë° ìœ ìš©í•  ê²ƒ ê°™ë‹¤. ì´ì™¸ì—ë„ flowchartjsë“± ì°¨íŠ¸ë¼ì´ë¸ŒëŸ¬ë¦¬ë„ ì‚¬ìš©ê°€ëŠ¥í•˜ë‹¤.\nthis is a text this is a text this is a text this is a text   Expand me  Some Markdown Contents   Image4: Image description   success  color Some contents  Some markdown contents Windows MacOS Ubuntu  Windows section 1  console.log(\u0026#39;Hello World!\u0026#39;);     MacOS section Hello world!  Ubuntu section Great!    'use strict'; var containerId = JSON.parse(\"\\\"12abf4928132c6bd\\\"\"); var containerElem = document.getElementById(containerId); var tabLinks = null; var tabContents = null; var ids = []; if (containerElem) { tabLinks = containerElem.querySelectorAll('.tab__link'); tabContents = containerElem.querySelectorAll('.tab__content'); } for (var i = 0; i 0) { tabContents[0].style.display = 'block'; }  emoji-cheat-sheet   I â¤ï¸ ğŸŸ\nzzo theme document\n","description":"","id":3,"section":"posts","tags":["zzo theme"],"title":"zzo theme shortcodes","uri":"https://Shin0102.github.io/posts/etc-zzo-theme-shotcodes/"},{"content":"   Experience Python(Django, FastAPI, Flask) Backend Developer\nAWS, EKS, Serverless Devops\nMigration legacy services to microservices\nInterst Full stack Developer(Learning React)\nDeep dive devops\nGolang\n","description":"Alli about page","id":4,"section":"","tags":null,"title":"About","uri":"https://Shin0102.github.io/about/"}]